/* Promo Wrap Container Styling
 * Targets .d-wrap[data-wrap] elements that have been assigned an ID
 * by the topic-promo.gjs initializer (matching configured promo tags)
 */

// Base styling for promo containers (only those with IDs from promo tags)
.cooked .d-wrap[data-wrap][id] {
  // CSS custom properties for theming
  --promo-accent: var(--#{$promo-wrap-accent});
  --promo-accent-low: var(--#{$promo-wrap-accent}-low);
  --promo-pad: var(--#{$promo-wrap-spacing});

  // Visual separation and emphasis
  background: var(--primary-very-low);
  border: 1px solid var(--primary-low);
  border-inline-start: 3px solid var(--promo-accent);
  border-radius: var(--border-radius);
  position: relative; // for highlight overlay

  // Spacing
  padding: var(--promo-pad);
  margin: var(--space-4) 0;

  // Subtle elevation
  box-shadow: 0 1px 3px rgb(0, 0, 0, 0.06);

  // Smooth anchor positioning (avoids hiding under sticky header)
  scroll-margin-top: calc(var(--header-offset, 60px) + var(--space-4));

  // Ensure content doesn't overflow
  overflow-wrap: break-word;
}

// Overlay-based highlight to ensure visibility over any base background
@media (prefers-reduced-motion: no-preference) {
  .cooked .d-wrap[data-wrap][id]:target::after,
  .cooked .d-wrap[data-wrap][id].promo-flash::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: inherit;
    background: var(--promo-accent-low, var(--tertiary-low));
    animation: promo-wrap-flash 1.25s ease-out;
    z-index: 1;
  }
}

@keyframes promo-wrap-flash {
  0% { background: var(--promo-accent-low, var(--tertiary-low)); }

  100% { background: transparent; }
}

// Mobile: compact padding option
@media (width <= 767px) {
  @if $promo-wrap-compact-mobile {
    .cooked .d-wrap[data-wrap][id] {
      // Reduce padding by one step on mobile
      @if $promo-wrap-spacing == "space-4" {
        --promo-pad: var(--space-3);
      } @else if $promo-wrap-spacing == "space-3" {
        --promo-pad: var(--space-2);
      }

      // space-2 stays at space-2 (minimum)
    }
  }
}


// Reduced motion fallback: static outline instead of animation
@media (prefers-reduced-motion: reduce) {
  .cooked .d-wrap[data-wrap][id]:target,
  .cooked .d-wrap[data-wrap][id].promo-flash {
    outline: 2px solid var(--highlight);
    outline-offset: 2px;
  }
}



/* BEM-based style variants for promo wrap */
.cooked .d-wrap[data-wrap][id].promo-wrap {
  // Accessible focus and hover states
  &:focus-within {
    outline: 2px solid var(--promo-accent);
    outline-offset: 2px;
  }

  @media (hover: hover) {
    &:hover {
      outline: 2px solid var(--promo-accent);
      outline-offset: 2px;
    }
  }

  &.promo-wrap--full-background {
    // High-contrast tinted background using accent low
    background: var(--tertiary-very-low);

    // Keep subtle neutral border; remove left accent bar
    border-color: var(--primary-low);
    border-inline-start-color: transparent;
    border-inline-start-width: 0;
  }

  &.promo-wrap--card-elevated {
    // Elevated card with neutral background and accent top bar
    background: var(--secondary);
    border-color: var(--primary-low);
    border-inline-start-color: transparent;
    border-inline-start-width: 0;
    box-shadow: 0 6px 18px rgb(0, 0, 0, 0.12), 0 2px 6px rgb(0, 0, 0, 0.06);
    transform: translateZ(0);
    transition: box-shadow 0.2s ease, transform 0.2s ease;

    // Use a real border for the accent bar to free ::before for badge label
    border-top: 4px solid var(--promo-accent);

    @media (hover: hover) {
      &:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 24px rgb(0, 0, 0, 0.16), 0 2px 8px rgb(0, 0, 0, 0.08);
      }
    }
  }
}

/* Badge display for promo containers with data-badge attribute */
.cooked .d-wrap[data-wrap][id][data-badge] {
  // Badge text label (extracted from data-badge attribute)
  &::before {
    content: attr(data-badge);
    position: absolute;
    inset-inline-start: var(--promo-pad);
    top: 0;
    transform: translateY(-50%);

    // Styling
    background: var(--tertiary);
    color: var(--secondary);
    padding: 0.25rem 0.6rem 0.25rem 1.8rem; // Extra left padding for icon
    border-radius: var(--border-radius);
    font-size: var(--font-down-1);
    font-weight: 600;
    line-height: 1.2;
    white-space: nowrap;

    // Interaction + stacking
    pointer-events: none;
    z-index: 2;

    // Subtle shadow for depth
    box-shadow: 0 2px 4px rgb(0 0 0 / 15%);
  }

  // Badge icon element (injected by decorateCooked as .promo-wrap__badge-icon)
  > .promo-wrap__badge-icon {
    position: absolute;
    inset-inline-start: calc(var(--promo-pad) + 0.45rem);
    top: 0;
    transform: translateY(-50%);

    // Icon sizing
    width: 1em;
    height: 1em;
    font-size: var(--font-down-1);

    // Render icon via mask (set by JS from settings.promo_button_icon)
    background: var(--secondary);
    mask-image: var(--promo-badge-icon);
    mask-size: contain;
    mask-repeat: no-repeat;
    mask-position: center;

    // Ensure icon appears above badge background
    z-index: 3;
    pointer-events: none;
  }
}

// Mobile: reduce badge padding for compact display
@media (width <= 767px) {
  .cooked .d-wrap[data-wrap][id][data-badge]::before {
    padding: 0.2rem 0.5rem 0.2rem 1.6rem;
    font-size: var(--font-down-2);
  }

  .cooked .d-wrap[data-wrap][id][data-badge] > .promo-wrap__badge-icon {
    inset-inline-start: calc(var(--promo-pad) + 0.35rem);
    font-size: var(--font-down-2);
  }
}
